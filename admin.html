<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin | Product Frank</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase SDKs -->
  <script type="module">
    // Importar Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.9.1/firebase-firestore.js";

    // Configuración Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA32F4wgtS15cmZADqAOMapYwtYhZKEGLk",
      authDomain: "tienda-web-3e959.firebaseapp.com",
      projectId: "tienda-web-3e959",
      storageBucket: "tienda-web-3e959.firebasestorage.app",
      messagingSenderId: "973911624370",
      appId: "1:973911624370:web:174c4b1ab8f6f3cbce97ab",
      measurementId: "G-TWY2T5XRFL"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Esperar a que el DOM cargue
    window.addEventListener('DOMContentLoaded', () => {

      const nameInput = document.getElementById('name');
      const priceInput = document.getElementById('price');
      const stockInput = document.getElementById('stock');
      const imgInput = document.getElementById('img');
      const descInput = document.getElementById('desc');
      const catSelect = document.getElementById('cat');
      const saveBtn = document.getElementById('saveBtn');
      const adminProducts = document.getElementById('adminProducts');

      // Guardar producto
      saveBtn.addEventListener('click', async () => {
        const name = nameInput.value;
        const price = parseFloat(priceInput.value);
        const stock = parseInt(stockInput.value);
        const img = imgInput.value;
        const desc = descInput.value;
        const category = catSelect.value;

        if (!name || !price || !stock) {
          alert("Completa todos los campos obligatorios");
          return;
        }

        try {
          await addDoc(collection(db, 'products'), {
            name,
            price,
            stock,
            img,
            desc,
            category,
            timestamp: new Date()
          });

          // Limpiar formulario
          nameInput.value = '';
          priceInput.value = '';
          stockInput.value = '';
          imgInput.value = '';
          descInput.value = '';
          catSelect.value = 'web';

        } catch (err) {
          console.error(err);
          alert("Error al guardar producto");
        }
      });

      // Mostrar productos en tiempo real
      const q = query(collection(db, 'products'), orderBy('timestamp', 'desc'));
      onSnapshot(q, snapshot => {
        adminProducts.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          adminProducts.innerHTML += `
            <div class="product-card">
              <img src="${data.img}" alt="${data.name}">
              <h3>${data.name}</h3>
              <p>${data.desc}</p>
              <p><strong>S/${data.price}</strong> | Stock: ${data.stock}</p>
              <p>Categoria: ${data.category}</p>
            </div>
          `;
        });
      });

    });

  </script>
</head>
<body>

<header>
  <h1>Panel de Administración</h1>
  <p>Product Frank</p>
</header>

<main class="admin-container">

  <section class="admin-form">
    <h2>Agregar / Editar producto</h2>

    <input id="name" placeholder="Nombre del producto">
    <input id="price" type="number" placeholder="Precio S/">
    <input id="stock" type="number" placeholder="Stock disponible">
    <input id="img" placeholder="URL de imagen">

    <!-- ✅ DESCRIPCIÓN -->
    <textarea id="desc" placeholder="Descripción del producto" rows="4"></textarea>

    <select id="cat">
      <option value="web">Artículos Web</option>
      <option value="accesorios">Accesorios</option>
    </select>

    <button id="saveBtn">➕ Agregar producto</button>
  </section>

  <section class="admin-list">
    <h2>Productos registrados</h2>
    <div id="adminProducts"></div>
  </section>

</main>

</body>
</html>
